<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vital Sport - Catalogues des Sports</title>
    <!-- Importation d'une police Google Fonts pour un meilleur rendu visuel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- Importation des icônes depuis Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Importation de la bibliothèque PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        /* Styles de base pour toutes les pages */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Inter', sans-serif;
            color: white;
            /* Fond avec dégradé animé */
            background: linear-gradient(-45deg, #f58220, #e06c00, #f58220, #e06c00);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Empêche le défilement */
        }

        /* Définition de l'animation pour le dégradé */
        @keyframes gradient-animation {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* En-tête de page */
        .page-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5vh 4vw;
            box-sizing: border-box;
            flex-shrink: 0;
        }
        .page-header .back-button {
            font-size: 3.5vh;
            color: white;
            text-decoration: none;
            transition: transform 0.2s ease;
        }
        .page-header .back-button:hover {
            transform: scale(1.1);
        }
        .page-header .logo {
            max-height: 20vh;
            max-width: 30vw;
        }

        /* Conteneur principal */
        .main-content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
            padding: 2vh 4vw;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .main-content-wrapper::-webkit-scrollbar {
            display: none;
        }

        /* Titre de la page */
        .main-title {
            font-size: 5vh;
            font-weight: 900;
            text-align: center;
            margin: 2vh 0 5vh;
            animation: pulse-heartbeat 2s infinite ease-in-out;
        }
        @keyframes pulse-heartbeat {
            0% { transform: scale(1); }
            20% { transform: scale(1.05); }
            50% { transform: scale(1); }
            80% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Grille des catalogues - Mise à jour pour le style "livres iOS" */
        .catalogue-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 40px; /* Espace augmenté entre les cartes */
            width: 100%;
            max-width: 1200px;
        }

        /* Carte de catalogue - Mise à jour pour le style "livres iOS" */
        .catalogue-card {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            /* Ombre plus prononcée pour l'effet de profondeur */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3), 0 6px 6px rgba(0, 0, 0, 0.2);
            
            /* Dimensions augmentées pour un effet plus grand */
            width: 250px;
            height: auto; /* La hauteur s'ajuste au contenu */
            
            /* Nouvelle animation pour indiquer l'interactivité */
            animation: pulse-card 3s infinite ease-in-out;
        }
        .catalogue-card:hover {
            transform: translateY(-10px); /* L'effet de survol est plus marqué */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 10px 10px rgba(0, 0, 0, 0.3);
            /* Arrête l'animation de pulse au survol */
            animation-play-state: paused;
        }

        /* Animation pour faire "pulser" légèrement les cartes */
        @keyframes pulse-card {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* Image du catalogue */
        .catalogue-image {
            width: 100%;
            height: 300px; /* Hauteur de l'image augmentée */
            object-fit: cover;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Ligne de séparation subtile */
        }

        /* Conteneur de chargement */
        .loading-container {
            width: 100%;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.05);
            font-size: 2vh;
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* Titre du catalogue */
        .catalogue-title {
            font-size: 2.8vh;
            font-weight: 700;
            padding: 20px 10px;
            margin: 0;
        }

        /* Modal du lecteur d'image */
        #image-viewer-modal {
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            justify-content: center;
            align-items: center;
            padding: 2vh;
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }
        #image-viewer-modal .modal-content {
            width: 95%;
            max-width: 95vw;
            height: 95%;
            max-height: 95vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: transparent;
            padding: 0;
            position: relative;
        }
        #image-viewer-modal img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .modal-close-button {
            position: absolute;
            top: 1.5vh;
            right: 1.5vw;
            color: #aaa;
            font-size: 4vh;
            font-weight: bold;
            cursor: pointer;
            z-index: 104;
        }
        .modal-close-button:hover,
        .modal-close-button:focus {
            color: #fff;
            text-decoration: none;
        }

        /* Modal du lecteur de PDF */
        #pdf-viewer-modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            padding: 2vh;
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }
        #pdf-viewer-modal .modal-content {
            width: 95%;
            max-width: 95vw;
            height: 95%;
            max-height: 95vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: transparent;
            padding: 0;
        }
        #pdf-viewer-container {
            flex-grow: 1;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        #pdf-viewer-container::-webkit-scrollbar {
            display: none;
        }
        #pdf-viewer-container canvas {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border-radius: 5px;
        }
        #pdf-viewer-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 2vh 0;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            margin-top: 1vh;
            flex-wrap: wrap; /* Permet aux éléments de passer à la ligne */
        }
        .pdf-nav-button {
            background-color: #f58220;
            color: white;
            border: none;
            padding: 1vh 2vw;
            border-radius: 8px;
            font-size: 2.5vh;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .pdf-nav-button:hover:not(:disabled) {
            background-color: #e06c00;
        }
        .pdf-nav-button:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }
        #page-info {
            font-size: 2.5vh;
            font-weight: bold;
        }
        #page-select {
            font-size: 2.5vh;
            padding: 0.5vh 1vw;
            border-radius: 8px;
            border: none;
            background-color: rgba(255, 255, 255, 0.8);
            color: #333;
            cursor: pointer;
        }

        /* Pied de page */
        .kiosk-footer {
            padding: 1vh;
            background-color: rgba(0, 0, 0, 0.1);
            text-align: center;
            flex-shrink: 0;
        }
        .kiosk-footer p {
            font-size: 1.4vh;
            margin: 0;
        }
        .kiosk-footer .legal-link {
            font-size: 1.4vh;
            color: white;
            text-decoration: underline;
            cursor: pointer;
        }

        /* Modal Mentions Légales */
        #legal-modal .modal-content {
            text-align: center; /* Centrage du texte de la modal des mentions légales */
            background-color: #fefefe;
            color: #333;
            padding: 3vh 3vw;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
        }
        #legal-modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            padding: 2vh;
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }
        .modal-content h2 {
            text-align: center;
        }
        .modal-content .editor-logo {
            max-height: 5vh;
            margin-bottom: 1vh;
        }
        .modal-content .partners-logo {
            max-width: 100%;
            height: auto;
            margin-top: 1vh;
        }
    </style>
</head>
<body>

    <!-- En-tête de la page -->
    <header class="page-header">
        <a href="index.html" class="back-button">
            <i class="fas fa-arrow-left"></i>
        </a>
        <img src="https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/refs/heads/main/logo_vital_sport_-removebg-preview.png" alt="Logo Vital Sport" class="logo">
    </header>

    <!-- Conteneur principal du contenu -->
    <main class="main-content-wrapper">
        <h1 class="main-title">Catalogues des Sports</h1>
        <div class="catalogue-grid" id="catalogue-grid">
            <!-- Les fiches des catalogues seront injectées ici par le JavaScript -->
        </div>
    </main>

    <!-- Pied de page -->
    <footer class="kiosk-footer">
        <p>&copy; 2025 Destination Sud Réunion</p>
        <a href="#" class="legal-link" id="show-legal-modal">Mentions légales</a>
    </footer>

    <!-- Modal pour le lecteur d'image -->
    <div id="image-viewer-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close-button" id="close-image-viewer-modal">&times;</span>
            <img id="image-viewer" src="" alt="Image agrandie">
        </div>
    </div>

    <!-- Modal pour le lecteur de PDF -->
    <div id="pdf-viewer-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close-button" id="close-pdf-viewer-modal">&times;</span>
            <div id="pdf-viewer-container">
                <canvas id="pdf-canvas"></canvas>
            </div>
            <div id="pdf-viewer-controls">
                <button id="prev-page" class="pdf-nav-button"><i class="fas fa-arrow-left"></i></button>
                <select id="page-select"></select>
                <button id="next-page" class="pdf-nav-button"><i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
    </div>

    <!-- Modal Mentions Légales -->
    <div id="legal-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close-button" id="close-legal-modal">&times;</span>
            <h2>Mentions Légales</h2>
            <img src="https://srias.re/wp-content/uploads/2020/12/Destination-Sud-Reunion-png-1-min.png" alt="Logo Destination Sud Réunion" class="editor-logo">
            <p><strong>Éditeur du site :</strong> Destination Sud Réunion</p>
            <p><strong>Adresse :</strong> Capitainerie du Port de Plaisance Lislet Geoffroy - place Napoléon Hoareau, 97410 Saint-Pierre</p>
            <p><strong>Contact :</strong><br>Téléphone : 0262353433<br>Email : saintpierre.tourisme@gmail.com</p>
            <p><strong>Hébergement :</strong><br>Google Cloud Platform</p>
            <p><strong>Propriété intellectuelle :</strong><br>Le contenu de ce site (textes, images, etc.) est la propriété exclusive de Decathlon Réunion, sauf mention contraire. Toute reproduction ou utilisation, même partielle, est interdite sans autorisation préalable.</p>
            <p><strong>Protection des données personnelles :</strong><br>Ce site ne collecte aucune donnée personnelle. Le jeu est conçu pour être anonyme et ne stocke aucune information sur les joueurs.</p>
            <h3>Partenaires</h3>
            <img src="https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/refs/heads/main/logo_partenaires-removebg-preview.png" alt="Logos partenaires" class="partners-logo">
            <p><strong>Crédits photos :</strong><br>Les images utilisées dans ce jeu proviennent de partenaires Destination Sud Réunion.</p>
        </div>
    </div>

    <script>
        // Définition des catalogues avec leurs informations
        const catalogues = [
            {
                id: 'sports-catalogue-1',
                image: 'https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/refs/heads/main/POST%20RS%20VITALSPORT-02.png',
                title: 'Affiche Vital Sport',
                description: 'Explorez la diversité des activités sportives disponibles au Vital Sport. Trouvez l\'activité qui vous convient !',
                file: 'https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/refs/heads/main/POST%20RS%20VITALSPORT-02.png',
                type: 'image'
            },
            {
                id: 'sports-catalogue-2',
                image: 'https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/refs/heads/main/POST%20RS%20VITALSPORT_Plan%20de%20travail%201.png',
                title: 'Le programme',
                description: 'Découvrez les équipements essentiels pour la course à pied, des chaussures aux accessoires connectés.',
                file: 'https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/refs/heads/main/POST%20RS%20VITALSPORT_Plan%20de%20travail%201.png',
                type: 'image'
            },
            {
                id: 'sports-catalogue-3',
                image: 'https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/refs/heads/main/CARNET%20d\'inspirations%20de%20sorties%20couverture.png',
                title: "Carnet d'activités",
                description: 'Tout ce qu\'il faut savoir sur les vélos et les équipements de sécurité pour profiter pleinement du cyclisme.',
                file: 'https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/refs/heads/main/CARNET%20d\'inspirations%20de%20sorties.pdf',
                type: 'pdf'
            },
            {
                id: 'catalogue-etang-sale',
                // L'image sera générée dynamiquement par le script ci-dessous
                image: '',
                title: 'L\'Étang-Salé',
                description: 'Découvrez la richesse naturelle et les activités offertes à L\'Étang-Salé.',
                file: 'https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/c95b1e7db6e3b05323c4ac129595f079a09f9d58/Etang_Sale_-_francais_anglais.pdf',
                type: 'pdf'
            },
            {
                id: 'plan-st-pierre',
                // L'image sera générée dynamiquement par le script ci-dessous
                image: '',
                title: 'Plan de Saint-Pierre',
                description: 'Découvrez le plan de Saint-Pierre pour vous orienter lors de l\'événement Vital Sport.',
                file: 'https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/420be5f7831595f0390d9b7ea10019b2fb20b385/1%20Plan%20de%20saint%20pierre%202022.pdf',
                type: 'pdf'
            },
            {
                id: 'plan-tev',
                // L'image sera générée dynamiquement par le script ci-dessous
                image: '',
                title: 'Plan Tévelave-Les Avirons',
                description: 'Explorez les sentiers de VTT (Territoire de l\'Est Varois) avec ce plan détaillé.',
                file: 'https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/c95b1e7db6e3b05323c4ac129595f079a09f9d58/PLAN_TEV_-_FR_ANG-min.pdf',
                type: 'pdf'
            },
            {
                id: 'catalogue-petite-ile',
                // L'image sera générée dynamiquement par le script ci-dessous
                image: '',
                title: 'Petite-Île',
                description: 'Découvrez les points d\'intérêts et les activités disponibles à Petite-Île.',
                file: 'https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/c95b1e7db6e3b05323c4ac129595f079a09f9d58/Petite_ile_-_francais_anglais.pdf',
                type: 'pdf'
            },
            {
                id: 'catalogue-saint-louis',
                // L'image sera générée dynamiquement par le script ci-dessous
                image: '',
                title: 'Saint-Louis',
                description: 'Explorez la commune de Saint-Louis et ses différentes offres d\'activités.',
                file: 'https://raw.githubusercontent.com/KaporalClems/borne-vital-sport/c95b1e7db6e3b05323c4ac129595f079a09f9d58/Saint_Louis_-_francais_anglais.pdf',
                type: 'pdf'
            }
        ];

        // Rendu des catalogues dans la page
        const catalogueGrid = document.getElementById('catalogue-grid');

        // Fonction asynchrone pour générer la miniature d'un PDF
        async function getPdfThumbnail(pdfUrl) {
            let pdf = null;
            let loadingTask = null;
            try {
                loadingTask = pdfjsLib.getDocument(pdfUrl);
                pdf = await loadingTask.promise;
                const page = await pdf.getPage(1);
                
                const viewport = page.getViewport({ scale: 1.0 });
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = 300; // Hauteur fixe pour la miniature
                canvas.width = viewport.width / (viewport.height / 300); // Proportionnel

                const renderContext = {
                    canvasContext: context,
                    viewport: page.getViewport({ scale: canvas.width / viewport.width }),
                };
                
                await page.render(renderContext).promise;
                return canvas.toDataURL();
            } catch (error) {
                console.error("Erreur lors de la génération de la miniature du PDF:", error);
                // Si la tâche de rendu est en cours, l'annuler
                if (loadingTask) {
                    loadingTask.destroy();
                }
                return 'https://placehold.co/250x300/e06c00/ffffff?text=PDF'; // Placeholder en cas d'erreur
            }
        }

        // Fonction pour créer une carte de catalogue (avec état de chargement)
        const createCatalogueCard = async (catalogue) => {
            const card = document.createElement('div');
            card.classList.add('catalogue-card');
            
            // État de chargement initial pour les PDF
            if (catalogue.type === 'pdf') {
                card.innerHTML = `
                    <div class="loading-container">Chargement...</div>
                    <h3 class="catalogue-title">${catalogue.title}</h3>
                `;
            } else {
                 card.innerHTML = `
                    <img src="${catalogue.image}" alt="Couverture du catalogue ${catalogue.title}" class="catalogue-image">
                    <h3 class="catalogue-title">${catalogue.title}</h3>
                `;
            }

            // Gère l'événement de clic
            card.addEventListener('click', () => {
                if (catalogue.type === 'pdf') {
                    showPdfViewer(catalogue.file);
                } else if (catalogue.type === 'image') {
                    showImageViewer(catalogue.file);
                }
            });

            // Si c'est un PDF, génère la miniature et met à jour la carte
            if (catalogue.type === 'pdf') {
                const thumbnail = await getPdfThumbnail(catalogue.file);
                card.innerHTML = `
                    <img src="${thumbnail}" alt="Couverture du catalogue ${catalogue.title}" class="catalogue-image">
                    <h3 class="catalogue-title">${catalogue.title}</h3>
                `;
            }
            
            return card;
        };
        
        // Fonction principale pour afficher tous les catalogues
        const renderCatalogues = async () => {
            catalogueGrid.innerHTML = '';
            catalogueGrid.style.justifyContent = catalogues.length > 2 ? 'space-between' : 'center';

            for (const catalogue of catalogues) {
                const card = await createCatalogueCard(catalogue);
                catalogueGrid.appendChild(card);
            }
        };

        // Gestion des modaux de visualisation
        const imageViewerModal = document.getElementById('image-viewer-modal');
        const imageViewer = document.getElementById('image-viewer');
        const pdfViewerModal = document.getElementById('pdf-viewer-modal');
        
        function showImageViewer(imageUrl) {
            imageViewer.src = imageUrl;
            imageViewerModal.style.display = 'flex';
        }

        function showPdfViewer(pdfUrl) {
            pdfViewerModal.style.display = 'flex';
            renderPdf(pdfUrl);
        }

        // Fermeture des modaux de visualisation
        document.getElementById('close-image-viewer-modal').addEventListener('click', () => {
            imageViewerModal.style.display = 'none';
        });

        document.getElementById('close-pdf-viewer-modal').addEventListener('click', () => {
            pdfViewerModal.style.display = 'none';
            // Arrêter le rendu de la page en cours si nécessaire
            if (currentPageInstance) {
                currentPageInstance.cancel();
                currentPageInstance = null; // Réinitialiser l'instance
            }
            currentPdf = null;
            // Nettoyer le canvas pour la prochaine utilisation
            const context = pdfCanvas.getContext('2d');
            context.clearRect(0, 0, pdfCanvas.width, pdfCanvas.height);
        });

        // Logique de lecture des PDF avec PDF.js
        let currentPdf = null;
        let currentPage = 1;
        let currentPageInstance = null;
        
        const pdfCanvas = document.getElementById('pdf-canvas');
        const pageSelect = document.getElementById('page-select');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');

        async function renderPdf(url) {
            currentPage = 1;
            let loadingTask = null;
            try {
                loadingTask = pdfjsLib.getDocument(url);
                const pdf = await loadingTask.promise;
                currentPdf = pdf;
                
                // Remplir la liste déroulante des pages
                pageSelect.innerHTML = ''; // Nettoyer les options précédentes
                for (let i = 1; i <= pdf.numPages; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Page ${i}`;
                    pageSelect.appendChild(option);
                }

                prevPageBtn.disabled = true;
                nextPageBtn.disabled = pdf.numPages <= 1;
                pageSelect.disabled = pdf.numPages <= 1;

                renderPage(currentPage);
            } catch (error) {
                console.error("Erreur lors du chargement du PDF:", error);
                // Utilisation d'un modal personnalisé au lieu d'alert()
                showCustomAlert("Impossible de charger le document PDF.");
                // Si la tâche de rendu est en cours, l'annuler
                if (loadingTask) {
                    loadingTask.destroy();
                }
                pdfViewerModal.style.display = 'none';
            }
        }

        async function renderPage(num) {
            if (!currentPdf) return;
            
            // Annuler la tâche de rendu précédente si elle existe
            if (currentPageInstance) {
                currentPageInstance.cancel();
            }
            
            try {
                const page = await currentPdf.getPage(num);
                const viewport = page.getViewport({ scale: 1.5 });
                
                // Ajuster la taille du canvas
                pdfCanvas.width = viewport.width;
                pdfCanvas.height = viewport.height;
                
                const renderContext = {
                    canvasContext: pdfCanvas.getContext('2d'),
                    viewport: viewport
                };

                // Mettre à jour la liste déroulante et l'état des boutons
                pageSelect.value = num;
                prevPageBtn.disabled = num === 1;
                nextPageBtn.disabled = num === currentPdf.numPages;
                
                currentPageInstance = page.render(renderContext);
                await currentPageInstance.promise; // Attendre la fin du rendu
            } catch (error) {
                console.error("Erreur lors du rendu de la page:", error);
                // Si l'erreur n'est pas une annulation de rendu, afficher une alerte
                if (error.name !== "RenderingCancelledException") {
                    showCustomAlert("Une erreur est survenue lors du rendu de la page.");
                    pdfViewerModal.style.display = 'none';
                }
            }
        }
        
        prevPageBtn.addEventListener('click', () => {
            if (currentPdf && currentPage > 1) {
                currentPage--;
                renderPage(currentPage);
            }
        });
        
        nextPageBtn.addEventListener('click', () => {
            if (currentPdf && currentPage < currentPdf.numPages) {
                currentPage++;
                renderPage(currentPage);
            }
        });

        // Gestion de la sélection de page via la liste déroulante
        pageSelect.addEventListener('change', (e) => {
            currentPage = parseInt(e.target.value);
            renderPage(currentPage);
        });

        // Gestion de la modal des mentions légales
        const legalModal = document.getElementById('legal-modal');
        const showLegalModalButton = document.getElementById('show-legal-modal');
        const closeLegalModalButton = document.getElementById('close-legal-modal');
        
        showLegalModalButton.addEventListener('click', (e) => {
            e.preventDefault();
            legalModal.style.display = 'flex';
        });

        closeLegalModalButton.addEventListener('click', () => {
            legalModal.style.display = 'none';
        });

        // Fermeture des modaux si on clique à l'extérieur
        window.addEventListener('click', (e) => {
            if (e.target === legalModal) {
                legalModal.style.display = 'none';
            }
            if (e.target === pdfViewerModal) {
                pdfViewerModal.style.display = 'none';
                // Annuler le rendu et nettoyer
                if (currentPageInstance) {
                    currentPageInstance.cancel();
                    currentPageInstance = null;
                }
                currentPdf = null;
            }
            if (e.target === imageViewerModal) {
                imageViewerModal.style.display = 'none';
            }
        });

        // Appelle la fonction pour afficher les catalogues au chargement de la page
        window.onload = renderCatalogues;

        // Assurez-vous que la variable globale pour pdf.js est bien définie
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js`;

        // Fonction pour un modal d'alerte personnalisé (remplace alert())
        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '50%';
            modal.style.left = '50%';
            modal.style.transform = 'translate(-50%, -50%)';
            modal.style.backgroundColor = 'white';
            modal.style.color = 'black';
            modal.style.padding = '20px';
            modal.style.borderRadius = '10px';
            modal.style.zIndex = '200';
            modal.style.boxShadow = '0 5px 15px rgba(0,0,0,0.5)';
            modal.textContent = message;
            
            document.body.appendChild(modal);

            setTimeout(() => {
                modal.remove();
            }, 3000);
        }
    </script>
</body>
</html>
