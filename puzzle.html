<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu Puzzle Vital Sport</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* Styles de base pour toutes les pages */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Inter', sans-serif;
            color: white;
            /* Fond avec dégradé animé */
            background: linear-gradient(-45deg, #00a99d, #007a73, #00a99d, #007a73);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Empêche le défilement */
        }

        /* Définition de l'animation pour le dégradé */
        @keyframes gradient-animation {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }


        /* En-tête de page secondaire */
        .page-header {
            width: 100%;
            display: flex;
            justify-content: space-between; /* Permet de placer les éléments aux extrémités */
            align-items: center; /* Centre les éléments verticalement */
            padding: 1.5vh 4vw;
            box-sizing: border-box;
            flex-shrink: 0;
        }
        .page-header .back-button {
            font-size: 3.5vh;
            color: white;
            text-decoration: none;
            transition: transform 0.2s ease;
        }
        .page-header .back-button:hover {
            transform: scale(1.1);
        }
        /* Style du logo Vital Sport (agrandi) */
        .page-header .logo {
            max-height: 8vh; /* Taille maximale du logo, ajustée pour la hauteur */
            max-width: 30vw; /* Empêche le logo d'être trop grand sur les grands écrans */
        }

        /* Conteneur principal du contenu du jeu, centré */
        .game-content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            padding: 0.5vh;
            box-sizing: border-box;
            overflow: hidden;
            /* Ajustement pour remonter le contenu */
            margin-top: -5vh; 
        }

        /* Titre du jeu */
        .main-title {
            font-size: 5vh;
            font-weight: 900;
            text-align: center;
            margin: 0 0 0.5vh;
            /* Animation de battement de cœur */
            animation: pulse-heartbeat 2s infinite ease-in-out;
        }
        /* Définition des keyframes pour l'animation */
        @keyframes pulse-heartbeat {
            0% { transform: scale(1); }
            20% { transform: scale(1.05); }
            50% { transform: scale(1); }
            80% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }


        /* Texte d'introduction du jeu */
        .intro-text {
            font-size: 2.2vh;
            font-weight: 400;
            text-align: center;
            margin-bottom: 1vh;
            max-width: 90%;
            color: white;
        }

        /* Minuteur */
        .timer {
            font-size: 3.5vh;
            font-weight: 700;
            margin-bottom: 1.5vh;
        }

        /* Conteneur de puzzle */
        .puzzle-container {
            position: relative;
            background-color: #e3f2fd;
            border-radius: 10px;
            padding: 3px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 2px;
            width: 85vmin;
            height: calc(85vmin * 4 / 5);
            max-height: 60vh;
        }

        /* Pièce de puzzle */
        .puzzle-piece {
            border: 1px solid rgba(0,0,0,0.1);
            background-size: 500% 400%;
            cursor: pointer;
            transition: transform 0.1s ease;
        }

        /* Conteneur d'image */
        .image-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 10px;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            display: none;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        /* Overlay de victoire */
        .win-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        .win-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }
        .win-overlay h2 {
            font-size: 4vh;
            font-weight: 900;
            margin: 0;
            color: white;
            animation: bounceIn 1s ease-in-out;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            80% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        /* Description du puzzle */
        .puzzle-info {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5vh 2.5vw;
            margin-top: 1.5vh;
            max-width: 90%;
            text-align: center;
            display: none;
            flex-shrink: 0;
        }
        .puzzle-info.show {
            display: block;
        }
        .puzzle-info h3 {
            font-size: 2.2vh;
            font-weight: 700;
            margin: 0 0 0.8vh;
            color: white;
        }
        .puzzle-info p {
            font-size: 1.8vh;
            font-weight: 400;
            margin: 0;
            color: white;
        }

        /* Tableau de bord du jeu */
        .game-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin-top: 1.5vh;
            gap: 1.5vh;
            flex-shrink: 0;
        }
        .control-buttons button {
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 6vh;
            height: 6vh;
            font-size: 3vh;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }
        .control-buttons button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0,0,0,0.15);
        }
        
        /* Pied de page */
        .kiosk-footer {
            padding: 1vh;
            background-color: rgba(0, 0, 0, 0.1);
            text-align: center;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5vh;
        }
        .kiosk-footer .footer-text {
            font-size: 1.4vh;
            margin: 0;
        }
        .kiosk-footer .legal-link {
            font-size: 1.4vh;
            color: white;
            text-decoration: underline;
            cursor: pointer;
            margin-top: 0.5vh;
        }

        /* Modal pour les mentions légales */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            padding: 2vh;
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: #fefefe;
            color: #333;
            padding: 3vh 3vw;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            text-align: center; /* Aligne le contenu du modal au centre */
        }
        .modal-close-button {
            position: absolute;
            top: 1.5vh;
            right: 1.5vw;
            color: #aaa;
            font-size: 4vh;
            font-weight: bold;
            cursor: pointer;
        }
        .modal-close-button:hover,
        .modal-close-button:focus {
            color: #000;
            text-decoration: none;
        }
        .modal-content h2 {
            font-size: 3vh;
            font-weight: 700;
            margin-top: 0;
        }
        .modal-content h3 {
            font-size: 2.5vh;
            font-weight: 700;
            margin-top: 2vh;
            margin-bottom: 1vh;
        }
        .modal-content p {
            font-size: 1.8vh;
            line-height: 1.5;
            margin-bottom: 1.5vh;
        }
        .modal-content .editor-logo,
        .modal-content .partners-logo {
            display: block; /* Important pour que margin:auto fonctionne */
            margin-left: auto;
            margin-right: auto;
        }
        .modal-content .editor-logo {
            max-height: 5vh;
            margin-bottom: 1vh;
        }
        .modal-content .partners-logo {
            max-width: 100%;
            height: auto;
            margin-top: 1vh;
        }
    </style>
</head>
<body>

    <header class="page-header">
        <a href="index.html" class="back-button">
            <i class="fas fa-arrow-left"></i>
        </a>
        <img src="logo_vital_sport_-removebg-preview.png" alt="Logo Vital Sport" class="logo">
    </header>

    <main class="game-content-wrapper">
        <h1 class="main-title">Jeu de Puzzle</h1>
        <p class="intro-text">Reconstituez l'image en glissant et déposant les pièces et découvrez l'activité. Bonne chance !</p>

        <span class="timer" id="timer">00:00</span>
        
        <div class="puzzle-container" id="puzzle-container">
            <div class="image-container" id="image-view"></div>
            <div class="win-overlay" id="win-overlay">
                <h2>Félicitations !</h2>
            </div>
        </div>

        <!-- Description du puzzle -->
        <div class="puzzle-info" id="puzzle-info">
            <h3 id="puzzle-title"></h3>
            <p id="puzzle-description"></p>
        </div>

        <!-- Tableau de bord du jeu -->
        <div class="game-controls">
            <div class="control-buttons">
                <button id="new-puzzle-button" title="Nouveau puzzle"><i class="fas fa-redo-alt"></i></button>
                <button id="view-image-button" title="Afficher l'image"><i class="fas fa-eye"></i></button>
            </div>
        </div>
    </main>
    
    <!-- ===== PIED DE PAGE ===== -->
    <footer class="kiosk-footer">
        <p class="footer-text">&copy; 2025 Decathlon</p>
        <a href="#" class="legal-link" id="show-legal-modal">Mentions légales</a>
    </footer>

    <!-- ===== MODAL MENTIONS LÉGALES ===== -->
    <div id="legal-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close-button" id="close-legal-modal">&times;</span>
            <h2>Mentions Légales</h2>
            <h3>Éditeur du site</h3>
            <img src="https://srias.re/wp-content/uploads/2020/12/Destination-Sud-Reunion-png-1-min.png" alt="Logo Destination Sud Réunion" class="editor-logo">
            <p><strong>Éditeur du site :</strong> Destination Sud Réunion</p>
            <p><strong>Adresse :</strong> Capitainerie du Port de Plaisance Lislet Geoffroy - place Napoléon Hoareau, 97410 Saint-Pierre</p>
            <p><strong>Contact :</strong><br>Téléphone : 0262353433<br>Email : saintpierre.tourisme@gmail.com</p>
            <p><strong>Hébergement :</strong><br>Google Cloud Platform</p>
            <p><strong>Propriété intellectuelle :</strong><br>Le contenu de ce site (textes, images, etc.) est la propriété exclusive de Decathlon Réunion, sauf mention contraire. Toute reproduction ou utilisation, même partielle, est interdite sans autorisation préalable.</p>
            <p><strong>Protection des données personnelles :</strong><br>Ce site ne collecte aucune donnée personnelle. Le jeu est conçu pour être anonyme et ne stocke aucune information sur les joueurs.</p>
            <h3>Partenaires</h3>
            <img src="logo_partenaires-removebg-preview.png" alt="Logos partenaires" class="partners-logo">
            <p><strong>Crédits photos :</strong><br>Les images utilisées dans ce jeu proviennent de partenaires Decathlon et de Crazy Adventures Réunion.</p>
        </div>
    </div>

    <script>
        const puzzleData = [
            {
                id: 1,
                image: "https://placehold.co/800x600/8dc63f/ffffff?text=Football",
                title: "Terrain de Football",
                description: "Un terrain de football Decathlon prêt pour un match."
            },
            {
                id: 2,
                image: "https://placehold.co/800x600/0072c6/ffffff?text=Basketball",
                title: "Match de Basketball",
                description: "Un ballon de basket en action sur le terrain."
            },
            {
                id: 3,
                image: "https://placehold.co/800x600/f58220/ffffff?text=Cyclisme",
                title: "Course de Cyclisme",
                description: "Un cycliste en pleine course, poussé par la foule."
            },
            {
                id: 4,
                image: "https://www.crazy-adventures.fr/ressources/images/f511fa13f9bd.jpg",
                title: "CRAZY ADVENTURES Réunion",
                description: "Spécialiste de la location de véhicule tout terrain en toute sécurité. Vivez votre crazy adventure ! 67 Chemin Vetyver 97410 SAINT-PIERRE - Heures d'ouverture : Lun - Dim 08h - 16h - Tél : 09 74 56 75 07"
            },
            {
                id: 5,
                image: "https://placehold.co/800x600/e94d8b/ffffff?text=Natation",
                title: "Piscine Olympique",
                description: "Un nageur s'entrainant dans la piscine."
            },
            {
                id: 6,
                image: "https://placehold.co/800x600/9b59b6/ffffff?text=Tennis",
                title: "Terrain de Tennis",
                description: "Échange de balles sur un court de tennis."
            },
            {
                id: 7,
                image: "https://placehold.co/800x600/3498db/ffffff?text=Boxe",
                title: "Boxe sur le ring",
                description: "Deux boxeurs s'affrontant sur le ring."
            },
            {
                id: 8,
                image: "https://placehold.co/800x600/f1c40f/ffffff?text=Course",
                title: "Course à pied",
                description: "Un coureur en pleine performance."
            },
            {
                id: 9,
                image: "https://placehold.co/800x600/e67e22/ffffff?text=Fitness",
                title: "Salle de Fitness",
                description: "Un entrainement de fitness en groupe."
            },
            {
                id: 10,
                image: "https://placehold.co/800x600/1abc9c/ffffff?text=Ski",
                title: "Ski en montagne",
                description: "Un skieur dévalant une piste enneigée."
            },
            {
                id: 11,
                image: "https://placehold.co/800x600/34495e/ffffff?text=Handball",
                title: "Match de Handball",
                description: "L'équipe de handball en plein match."
            },
            {
                id: 12,
                image: "https://placehold.co/800x600/e74c3c/ffffff?text=Volley",
                title: "Volley-ball sur la plage",
                description: "Un match de volley-ball sur la plage."
            },
            {
                id: 13,
                image: "https://placehold.co/800x600/2980b9/ffffff?text=Rugby",
                title: "Match de Rugby",
                description: "Un joueur de rugby portant le ballon."
            },
            {
                id: 14,
                image: "https://placehold.co/800x600/95a5a6/ffffff?text=Escalade",
                title: "Mur d'escalade",
                description: "Un grimpeur en pleine ascension."
            },
            {
                id: 15,
                image: "https://placehold.co/800x600/2c3e50/ffffff?text=Judo",
                title: "Entrainement de Judo",
                description: "Deux judokas s'affrontant en judo."
            }
        ];

        const COLS = 5;
        const ROWS = 4;
        const totalPieces = COLS * ROWS;
        let currentPuzzle = null;
        let pieces = [];
        let isStarted = false;
        let timerInterval = null;
        let seconds = 0;
        let isSolved = false;

        const puzzleContainer = document.getElementById('puzzle-container');
        const imageView = document.getElementById('image-view');
        const puzzleInfo = document.getElementById('puzzle-info');
        const puzzleTitle = document.getElementById('puzzle-title');
        const puzzleDescription = document.getElementById('puzzle-description');
        const timerDisplay = document.getElementById('timer');
        const viewImageButton = document.getElementById('view-image-button');
        const newPuzzleButton = document.getElementById('new-puzzle-button');
        const winOverlay = document.getElementById('win-overlay');
        const showLegalModalButton = document.getElementById('show-legal-modal');
        const legalModal = document.getElementById('legal-modal');
        const closeLegalModalButton = document.getElementById('close-legal-modal');

        // Fonction pour sélectionner un puzzle aléatoire
        function getRandomPuzzle() {
            const randomIndex = Math.floor(Math.random() * puzzleData.length);
            return puzzleData[randomIndex];
        }

        // Fonction pour initialiser le puzzle
        function initPuzzle() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            isStarted = false;
            seconds = 0;
            isSolved = false;
            winOverlay.classList.remove('show');
            puzzleInfo.style.display = 'none'; // Cache la description et le titre
            timerDisplay.textContent = '00:00';
            
            // Choix aléatoire d'un nouveau puzzle
            currentPuzzle = getRandomPuzzle();
            imageView.style.backgroundImage = `url(${currentPuzzle.image})`;

            // Nettoyage de l'ancien puzzle
            puzzleContainer.innerHTML = '';
            puzzleContainer.appendChild(imageView);
            puzzleContainer.appendChild(winOverlay);
            pieces = [];

            // Création des pièces
            for (let i = 0; i < totalPieces; i++) {
                const piece = document.createElement('div');
                piece.classList.add('puzzle-piece');
                piece.style.backgroundImage = `url(${currentPuzzle.image})`;

                const row = Math.floor(i / COLS);
                const col = i % COLS;

                const bgX = (col / (COLS - 1)) * 100;
                const bgY = (row / (ROWS - 1)) * 100;

                piece.style.backgroundPosition = `${bgX}% ${bgY}%`;
                piece.dataset.index = i;
                
                pieces.push(piece);
            }

            shufflePieces();
            pieces.forEach(piece => puzzleContainer.appendChild(piece));

            // Ajout des événements de drag and drop
            pieces.forEach(piece => {
                piece.draggable = true;
                piece.addEventListener('dragstart', handleDragStart);
                piece.addEventListener('dragover', handleDragOver);
                piece.addEventListener('drop', handleDrop);
                piece.addEventListener('dragenter', handleDragEnter);
                piece.addEventListener('dragleave', handleDragLeave);
            });
        }

        // Mélange les pièces
        function shufflePieces() {
            for (let i = pieces.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                const tempPiece = pieces[i];
                pieces[i] = pieces[j];
                pieces[j] = tempPiece;
            }
        }

        // Drag and Drop
        let draggedPiece = null;

        function handleDragStart(e) {
            draggedPiece = e.target;
            // Démarre le timer si ce n'est pas déjà fait
            if (!isStarted) {
                startTimer();
                isStarted = true;
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.target.style.opacity = 0.5;
        }
        
        function handleDragLeave(e) {
            e.target.style.opacity = 1;
        }

        // CORRECTION DU BUG DANS CETTE FONCTION
        function handleDrop(e) {
            e.preventDefault();
            const dropTarget = e.target;

            if (dropTarget.classList.contains('puzzle-piece')) {
                dropTarget.style.opacity = 1;
            }
            
            if (draggedPiece && draggedPiece !== dropTarget && dropTarget.classList.contains('puzzle-piece')) {
                const tempParent = puzzleContainer;
                const tempNextSibling = draggedPiece.nextSibling === dropTarget ? draggedPiece : draggedPiece.nextSibling;

                // On s'assure d'avoir un "placeholder" pour l'élément à déplacer
                const dropTargetNextSibling = dropTarget.nextSibling;
                
                // Déplace la pièce glissée à la position de la cible
                tempParent.insertBefore(draggedPiece, dropTargetNextSibling);
                // Déplace la cible à la position initiale de la pièce glissée
                tempParent.insertBefore(dropTarget, tempNextSibling);
                
                checkWin();
            }
        }
        
        // Vérification de la victoire
        function checkWin() {
            let isCorrect = true;
            const currentPieces = Array.from(puzzleContainer.querySelectorAll('.puzzle-piece'));

            for (let i = 0; i < currentPieces.length; i++) {
                if (parseInt(currentPieces[i].dataset.index) !== i) {
                    isCorrect = false;
                    break;
                }
            }

            if (isCorrect && !isSolved) {
                isSolved = true;
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                setTimeout(() => {
                    winOverlay.classList.add('show');
                    puzzleInfo.style.display = 'block'; // Affiche la description et le titre
                    puzzleTitle.textContent = currentPuzzle.title;
                    puzzleDescription.textContent = currentPuzzle.description;
                }, 500);
            }
        }
        
        // Fonctionnalité du timer
        function startTimer() {
            timerInterval = setInterval(() => {
                seconds++;
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                timerDisplay.textContent = `${minutes < 10 ? '0' : ''}${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
            }, 1000);
        }

        // Bouton pour changer de puzzle
        newPuzzleButton.addEventListener('click', () => {
            initPuzzle();
        });

        // Bouton pour voir l'image
        let isImageViewVisible = false;
        viewImageButton.addEventListener('click', () => {
            isImageViewVisible = !isImageViewVisible;
            if (isImageViewVisible) {
                imageView.style.display = 'block';
                viewImageButton.innerHTML = `<i class="fas fa-eye-slash"></i>`;
            } else {
                imageView.style.display = 'none';
                viewImageButton.innerHTML = `<i class="fas fa-eye"></i>`;
            }
        });

        // Gestion de la modal des mentions légales
        showLegalModalButton.addEventListener('click', (e) => {
            e.preventDefault();
            legalModal.style.display = 'flex';
        });

        closeLegalModalButton.addEventListener('click', () => {
            legalModal.style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target === legalModal) {
                legalModal.style.display = 'none';
            }
        });


        // Initialisation au chargement de la page
        window.onload = initPuzzle;

    </script>
</body>
</html>
